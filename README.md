# Telegram Candidate Testing Bot

**Описание:**  
Бот для тестирования кандидатов, позволяющий HR и администраторам назначать тесты и отслеживать результаты. Написан на Go, поддерживает режимы long polling и webhook, имеет гибкую систему хранения состояний и генерирует PDF-отчёты.

## Функциональность
- Назначение тестов кандидатам (отложенные назначения* через inline-кнопки)
- Проведение тестов с логикой вопросов
- Асинхронный таймер с защитой от перезагрузки приложения
- Хранение состояния пользователей (in-memory или JSON)
- Генерация PDF-отчётов по результатам тестирования

_*Отложенные назначения решают проблему безопасности телеграмма, когда нельзя получить ID пользователя по нику для назначения теста, пока он не нажмет /start. В случае отложенного назначения, мы сохраняем ник пользователя в базу и когда пользователь с таким ником напишет /start, мы получим его ID и сразу найдем созданный для него тест._

## Конфигурация
Создайте файл `.env` с следующими переменными:

```env
# Токен Telegram-бота, полученный через BotFather.
TELEGRAM_BOT_TOKEN=your_tg_bot_token

# Режим работы: "polling" или "webhook"
BOT_MODE=polling

# Публичный URL для вебхуков (используется, если BOT_MODE=webhook)
WEBHOOK_URL=https://yourdomain.com/telegram

# Адрес и порт для прослушивания вебхуков (например, для TLS)
LISTEN_ADDR=:8443

# Интервал для лонгпуллинга (в секундах)
POLL_INTERVAL=2

# Включение режима отладки (подробное логирование)
DEBUG=false

# Конфигурация теста: количество вопросов и время на прохождение (в минутах)
TEST_QUESTIONS=30
TEST_DURATION=25

# Тип хранилища: "memory" или "json"
STORAGE_TYPE=json

# Список администраторов (Telegram ID), разделённых запятой
ADMIN_IDS=123456789,987654321
```

## Создание вопросв для тестов
- **data/questions.json** – JSON файл, хранит в себе массив вопросов, из которых будут формироваться тесты для кандидатов.

Формат данных вида:
```json
[
  {
    "id": 1,
    "text": "Силлогизм 1: Все A – B. Все B – C. Следует ли, что все A – C?",
    "options": ["Да", "Нет", "Не уверен"],
    "answer": 0
  },
  {
    "id": 2,
    "text": "Силлогизм 2: Все X – Y. Все Z – X. Следует ли, что все Z не Y?",
    "options": ["Да", "Нет", "Не уверен"],
    "answer": 1
  }
]
```
## Формирование теста из вопросов
- Тесты гарантированно формируются ровно из _TEST_QUESTIONS_ вопросов.
- Гарантируется, что вопросы в тесте уникальны.
- Если кандидаты решают тест параллельно, реализован механизм резервирования вопросов, когда вопросы между кандидатами уникальны. 

_В случае, если для формирования теста, не хватает свободных вопросов, оставшиеся будут формироваться из взятых другими кандидатами._



## Установка и запуск
1. **Клонирование репозитория:**
   ```bash
   git clone https://github.com/firstBitSportivnaya/hr-tg-bot.git
   cd hr-tg-bot
   ```
2. **Установка зависимостей:**
   ```bash
   go mod tidy
   ```
3. **Сборка проекта:**
   ```bash
   go build -o bot ./cmd/hrbot
   ```
4. **Запуск бота:**
   ```bash
   ./bot
   ```

## Структура проекта
- **main.go** – точка входа, настройка бота и запуск.
- **config** – загрузка конфигурации из .env и переменных окружения.
- **database** – хранение состояний пользователей.
- **handlers** – обработчики команд и inline-кнопок.
- **helpers** – функции для работы с таймерами и обновлением сообщений.
- **middleware** – цепочка middleware для логирования, обработки ошибок и автоматических ответов.
- **pending** – отложенные назначения теста и ролей.
- **poller** – настройка получения обновлений (polling или webhook).
- **report** – генерация PDF-отчётов.
- **tasks** – работа с вопросами теста.

## Лицензия
Проект распространяется под лицензией MIT.
